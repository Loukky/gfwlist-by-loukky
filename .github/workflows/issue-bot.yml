name: Issue Auto Management

on:
  issues:
    types: [opened, closed]

jobs:
  handle-issues:
    runs-on: ubuntu-latest

    steps:
      - name: Auto manage issue lifecycle
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const issueNumber = issue.number;

            // === 1ï¸âƒ£ æ–°å»º Issue ===
            if (context.payload.action === "opened") {
              console.log(`New issue #${issueNumber} detected.`);

              // è‡ªåŠ¨å›å¤
              const message = `
ğŸ‘‹ æ„Ÿè°¢ä½ æäº¤ Issueï¼

è¯·åœ¨åé¦ˆå‰ç¡®è®¤ä»¥ä¸‹å‡ ç‚¹ï¼š
- âœ… è¯¥åŸŸåæˆ–ç½‘ç«™å·²åœ¨å¤šä¸ªç½‘ç»œç¯å¢ƒä¸‹ï¼ˆä¾‹å¦‚ç§»åŠ¨/è”é€š/ç”µä¿¡ã€å¢ƒå¤–ç½‘ç»œï¼‰æµ‹è¯•ï¼Œç¡®å®è¢« GFW å±è”½ï¼›
- ğŸ§© å¦‚æœåªæ˜¯æš‚æ—¶æ€§è®¿é—®å¼‚å¸¸ï¼Œè¯·å…ˆå¤šæ¬¡æµ‹è¯•ç¡®è®¤ï¼›
- ğŸŒ å»ºè®®é™„ä¸Š dig/ping/mtr ç­‰æµ‹è¯•æˆªå›¾æˆ–ç»“æœï¼Œä»¥ä¾¿æˆ‘ä»¬å¤ç°é—®é¢˜ã€‚

---

**English:**
Hi! Thanks for submitting an issue.

Before reporting, please make sure:
- âœ… The domain or site has been tested from multiple networks (e.g., China Mobile/Unicom/Telecom and abroad) and is truly blocked by GFW;
- ğŸ§© If itâ€™s only a temporary connection failure, please double-check it several times;
- ğŸŒ Itâ€™s recommended to attach dig/ping/mtr results or screenshots for reference.

Thank you for helping us keep the GFWList accurate! ğŸ™
`;

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issueNumber,
                body: message
              });

              // æ·»åŠ  unconfirmed æ ‡ç­¾
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issueNumber,
                labels: ["unconfirmed"]
              });
            }

            // === 2ï¸âƒ£ Issue è¢«å…³é—­ ===
            else if (context.payload.action === "closed") {
              console.log(`Issue #${issueNumber} closed.`);

              // å¦‚æœ issue æ˜¯è¢«çœŸæ­£å…³é—­ï¼ˆä¸æ˜¯é‡æ–°æ‰“å¼€ï¼‰
              if (!issue.state_reason || issue.state_reason !== "reopened") {
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issueNumber,
                  labels: ["fixed"]
                });

                console.log(`Added 'fixed' label to issue #${issueNumber}.`);
              }
            }
